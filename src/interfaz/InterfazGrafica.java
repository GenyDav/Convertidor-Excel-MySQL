package interfaz;

import bd.GeneradorBD;
import datos.ElementoLista;
import bd.Conexion;
import java.awt.CardLayout;
import java.awt.Color;
import java.sql.SQLException;
import java.util.ArrayList;
import javax.swing.DefaultListModel;
import javax.swing.ImageIcon;
import javax.swing.JList;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.SwingWorker;
import javax.swing.SwingWorker.StateValue;
import javax.swing.UIManager;


/**
 *
 * @author Geny
 */
public class InterfazGrafica extends javax.swing.JFrame {
    private CardLayout cardLayout;
    private String servidor;        // dirección o nombre del servidor de bases de datos
    private String usuario;         // nombre del usuario
    private String clave;           // contraseña para acceder al servidor
    private Conexion conn;          // encargado de realizar la conexión y consultas a la base de datos
    private String mensaje;         // mensaje de la pantalla de inicio
    private int modo;               // 
    private final int EXP;
    private final int IMP; 
    private GeneradorBD genBD;
       
    private PanelExport panelExp;
    private PanelImport panelImp;
    
    public InterfazGrafica() {
        UIManager.put("ProgressBar.selectionForeground", Color.white);
        UIManager.put("ProgressBar.foreground", new Color(2,97,140));//255,148,0
        
        initComponents();
        setIconImage(new ImageIcon(getClass().getResource("/imagenes/icono_frame.png")).getImage());
        setResizable(false);
        setTitle("Convertidor MySQL/Excel");
        setSize(1000,600);
        setLocationRelativeTo(null);
        
        cardLayout = (CardLayout)jPanel1.getLayout();
        
        servidor = "";
        usuario = "";
        clave = "";
        mensaje = "";
       
        EXP = 1;
        IMP = 2;
        modo = EXP;
        
        genBD = new GeneradorBD();   
        // Inicialización de variables para leer archivoExcel
        panelExp = null;
        panelImp = null;
        
        panelExp = new PanelExport(this,jPanel1);
        panelImp = new PanelImport(this,jPanel1);
    }
    
    public static <T extends ElementoLista> void mostrarListaElementos(ArrayList<T> lista){
        for(int i=0;i<lista.size();i++){
            System.out.print("["+lista.get(i).estaSeleccionado()+"]");
        }
        System.out.println();
    }
    
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jPanel3 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        txtUsuario = new javax.swing.JTextField();
        txtServidor = new javax.swing.JTextField();
        txtClave = new javax.swing.JPasswordField();
        btnConectar = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        jScrollPane3 = new javax.swing.JScrollPane();
        msj = new javax.swing.JTextArea();
        jLabel13 = new javax.swing.JLabel();
        jPanel4 = new javax.swing.JPanel();
        jPanel5 = new javax.swing.JPanel();
        modoExport = new javax.swing.JButton();
        modoImport = new javax.swing.JButton();
        btnSalir = new javax.swing.JButton();
        jPanel7 = new javax.swing.JPanel();
        panelExport = new javax.swing.JPanel();
        jLabel7 = new javax.swing.JLabel();
        panelImport = new javax.swing.JPanel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DO_NOTHING_ON_CLOSE);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                cerrarVentana(evt);
            }
        });

        jPanel1.setLayout(new java.awt.CardLayout());

        jPanel3.setBackground(new java.awt.Color(255, 255, 255));
        jPanel3.setForeground(new java.awt.Color(102, 102, 102));

        jPanel2.setBackground(new java.awt.Color(51, 51, 51));
        jPanel2.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 102, 102)));
        jPanel2.setForeground(new java.awt.Color(255, 255, 255));
        jPanel2.setMaximumSize(new java.awt.Dimension(265, 364));
        jPanel2.setName(""); // NOI18N

        jLabel5.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        jLabel5.setForeground(new java.awt.Color(255, 255, 255));
        jLabel5.setText("Nombre de usuario");

        jLabel6.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        jLabel6.setForeground(new java.awt.Color(255, 255, 255));
        jLabel6.setText("Dirección del servidor");

        jLabel8.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        jLabel8.setForeground(new java.awt.Color(255, 255, 255));
        jLabel8.setText("Contraseña");

        txtUsuario.setText("root");
        txtUsuario.setAutoscrolls(false);
        txtUsuario.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(255, 255, 255), 3));
        txtUsuario.setCursor(new java.awt.Cursor(java.awt.Cursor.TEXT_CURSOR));

        txtServidor.setText("localhost");
        txtServidor.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(255, 255, 255), 3));

        txtClave.setText("root");
        txtClave.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(255, 255, 255), 3));

        btnConectar.setText("Conectar");
        btnConectar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnConectarActionPerformed(evt);
            }
        });

        jLabel1.setFont(new java.awt.Font("Dialog", 1, 16)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(255, 255, 255));
        jLabel1.setText("Datos de conexión");

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(25, 25, 25)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jLabel8, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel6)
                    .addComponent(btnConectar, javax.swing.GroupLayout.DEFAULT_SIZE, 210, Short.MAX_VALUE)
                    .addComponent(txtClave)
                    .addComponent(jLabel5)
                    .addComponent(txtServidor)
                    .addComponent(txtUsuario)
                    .addComponent(jLabel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap(28, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(25, 25, 25)
                .addComponent(jLabel1)
                .addGap(18, 18, 18)
                .addComponent(jLabel6)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtServidor, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jLabel5)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtUsuario, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jLabel8)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtClave, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 377, Short.MAX_VALUE)
                .addComponent(btnConectar, javax.swing.GroupLayout.PREFERRED_SIZE, 38, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(25, 25, 25))
        );

        jScrollPane3.setBackground(new java.awt.Color(255, 255, 255));
        jScrollPane3.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        msj.setEditable(false);
        msj.setColumns(20);
        msj.setLineWrap(true);
        msj.setRows(4);
        msj.setWrapStyleWord(true);
        msj.setFocusable(false);
        msj.setRequestFocusEnabled(false);
        jScrollPane3.setViewportView(msj);

        jLabel13.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagenes/panel.png"))); // NOI18N

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addGap(12, 12, 12)
                        .addComponent(jScrollPane3, javax.swing.GroupLayout.DEFAULT_SIZE, 732, Short.MAX_VALUE)
                        .addContainerGap())
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addGap(37, 37, 37)
                        .addComponent(jLabel13))))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel3Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel13)
                .addGap(47, 47, 47)
                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18))
        );

        jPanel1.add(jPanel3, "card2");

        jPanel4.setBackground(new java.awt.Color(152, 152, 152));

        jPanel5.setBackground(new java.awt.Color(51, 51, 51));
        jPanel5.setForeground(new java.awt.Color(255, 255, 255));

        modoExport.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagenes/btn1.png"))); // NOI18N
        modoExport.setToolTipText("Convertir una base de datos en un archivo de Excel");
        modoExport.setBorder(null);
        modoExport.setBorderPainted(false);
        modoExport.setContentAreaFilled(false);
        modoExport.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        modoExport.setDefaultCapable(false);
        modoExport.setFocusPainted(false);
        modoExport.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                btnExportarMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                btnExportarMouseExited(evt);
            }
        });
        modoExport.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                modoExportActionPerformed(evt);
            }
        });

        modoImport.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagenes/btn2.png"))); // NOI18N
        modoImport.setToolTipText("Crear una base de datos desde un archivo de Excel");
        modoImport.setBorder(null);
        modoImport.setBorderPainted(false);
        modoImport.setContentAreaFilled(false);
        modoImport.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        modoImport.setDefaultCapable(false);
        modoImport.setFocusPainted(false);
        modoImport.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                btnImportMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                btnImportMouseExited(evt);
            }
        });
        modoImport.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                modoImportActionPerformed(evt);
            }
        });

        btnSalir.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagenes/salir1.png"))); // NOI18N
        btnSalir.setToolTipText("Cerrar la conexión");
        btnSalir.setBorderPainted(false);
        btnSalir.setContentAreaFilled(false);
        btnSalir.setDefaultCapable(false);
        btnSalir.setFocusPainted(false);
        btnSalir.setPressedIcon(new javax.swing.ImageIcon(getClass().getResource("/imagenes/salir3.png"))); // NOI18N
        btnSalir.setRolloverIcon(new javax.swing.ImageIcon(getClass().getResource("/imagenes/salir2.png"))); // NOI18N
        btnSalir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSalirActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel5Layout.createSequentialGroup()
                .addGap(0, 6, Short.MAX_VALUE)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(modoImport, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(modoExport, javax.swing.GroupLayout.PREFERRED_SIZE, 66, javax.swing.GroupLayout.PREFERRED_SIZE)))
            .addComponent(btnSalir, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addGap(6, 6, 6)
                .addComponent(modoExport)
                .addGap(0, 0, 0)
                .addComponent(modoImport)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btnSalir)
                .addGap(5, 5, 5))
        );

        jPanel7.setBackground(new java.awt.Color(255, 255, 255));
        jPanel7.setMaximumSize(new java.awt.Dimension(944, 600));
        jPanel7.setLayout(new java.awt.CardLayout());

        panelExport.setBackground(new java.awt.Color(255, 255, 255));

        jLabel7.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        jLabel7.setText("Exportar tablas de MySQL a Excel");

        javax.swing.GroupLayout panelExportLayout = new javax.swing.GroupLayout(panelExport);
        panelExport.setLayout(panelExportLayout);
        panelExportLayout.setHorizontalGroup(
            panelExportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelExportLayout.createSequentialGroup()
                .addGap(36, 36, 36)
                .addComponent(jLabel7)
                .addContainerGap(605, Short.MAX_VALUE))
        );
        panelExportLayout.setVerticalGroup(
            panelExportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelExportLayout.createSequentialGroup()
                .addGap(30, 30, 30)
                .addComponent(jLabel7)
                .addGap(528, 528, 528))
        );

        jPanel7.add(panelExport, "cardExport");

        panelImport.setBackground(new java.awt.Color(255, 255, 255));

        javax.swing.GroupLayout panelImportLayout = new javax.swing.GroupLayout(panelImport);
        panelImport.setLayout(panelImportLayout);
        panelImportLayout.setHorizontalGroup(
            panelImportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 937, Short.MAX_VALUE)
        );
        panelImportLayout.setVerticalGroup(
            panelImportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 695, Short.MAX_VALUE)
        );

        jPanel7.add(panelImport, "cardImport");

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jPanel7, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel7, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addComponent(jPanel5, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        jPanel1.add(jPanel4, "pantallaSecundaria");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnSalirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSalirActionPerformed
        Object []opciones = {"Aceptar","Cancelar"};
        new SwingWorker<Void,Void>(){
            @Override
            protected Void doInBackground() throws Exception { 
                System.out.println(panelExp.consultarEstadoProceso());
                if((panelExp.consultarEstadoProceso()==StateValue.STARTED)||(genBD.getState()==StateValue.STARTED)){
                    System.out.println("========");
                    int eleccion = JOptionPane.showOptionDialog(
                        null,
                        "Hay procesos ejecutándose, ¿desea cerrar la conexión?  ",
                        "Confirmar cierre",
                        JOptionPane.YES_NO_OPTION,
                        JOptionPane.QUESTION_MESSAGE,null,opciones,"Aceptar"
                    );
                    if (eleccion == JOptionPane.YES_OPTION){ 
                        //generadorArch.cancel(true);
                        panelExp.cancelarProceso();
                        genBD.cancel(true);
                        terminarConexion();             
                    }
                }else{
                    System.out.println("........");
                    terminarConexion();
                }
                return null;
            }
        }.execute();  
    }//GEN-LAST:event_btnSalirActionPerformed
    
    private void terminarConexion(){
        cardLayout.show(jPanel1, "card2");  
        conn.terminarConexion();
        reiniciarCamposInicio();
        modo = 1;
        modoExport.setIcon(new ImageIcon(getClass().getResource("/imagenes/btn1.png")));
        modoImport.setIcon(new ImageIcon(getClass().getResource("/imagenes/btn2.png")));
        //panelExp.reiniciarElementosExportacion();
        panelExp = null;
        //reiniciarElementosImportacion();
        panelImp = null;
    }
    
    /**
     * Método que elimina todos los elementos que están en la lista de exportación/importación.
     * @param <T> Objetos de la clase ElementoLista o que hereden de ella.
     * @param elemento Tipo de elemento que va a ser eliminado (tabla u hoja).
     * @param modeloLista Modelo del jList donde están las tablas seleccionadas.
     * @param listaAux Estructura de datos con la información de las tablas.
     * @return Valor entero que indica si el usuario ha confirmado o cancelado
     * la eliminación de los elementos de la lista.
     */
    public static <T extends ElementoLista> int limpiarSeleccion(JPanel panel,String elemento,DefaultListModel modeloLista,ArrayList<T> listaAux){
        int resp = JOptionPane.showConfirmDialog(
            panel, 
            "Todas las "+elemento+" en la lista se \nborrarán. ¿Continuar?",
            "¿Borrar todo?", 
            JOptionPane.OK_CANCEL_OPTION,
            JOptionPane.QUESTION_MESSAGE
        );
        if(resp == JOptionPane.OK_OPTION){                
            ElementoLista elem;
            for(int i=modeloLista.getSize()-1;i>=0;i--){
                elem = (ElementoLista)modeloLista.getElementAt(i);
                // desmarca como seleccionado el elemento en la estructura de datos
                listaAux.get(elem.getPosicion()).setSeleccionado(false);
            }
            //mostrarListaElementos(listaAux);
            modeloLista.clear();
        }
        return resp;
    }
    
    /**
     * Método que permite eliminar los elementos seleccionados en la lista de 
     * exportación.
     * @param <T> Objetos de la clase ElementoLista o que hereden de ella.
     * @param seleccion JList en donde están las tablas seleccionadas.
     * @param modeloLista Modelo del jList donde están las tablas seleccionadas.
     * @param lista Estructura de datos con la información de las tablas.
     */
    public static <T extends ElementoLista> void borrarElemento(JList seleccion,DefaultListModel modeloLista,ArrayList<T> lista){
        int []elemSeleccionados; // posicion de los elementos que se van a borrar
        T elemento; // elemento que se va a eliminar
        
        elemSeleccionados = seleccion.getSelectedIndices(); // Obtener las posiciones de los elementos a eliminar
        for(int i=elemSeleccionados.length-1;i>=0;i--){
            elemento = (T)modeloLista.getElementAt(elemSeleccionados[i]);      
            lista.get(elemento.getPosicion()).setSeleccionado(false); // Desmarcar el elemento de la estructura de datos 
            modeloLista.remove(elemSeleccionados[i]);
            //mostrarListaElementos();
        }
        if(elemSeleccionados.length>1){  // si se seleccionaron varios elementos para borrarlos
            if(!modeloLista.isEmpty())
                seleccion.setSelectedIndex(0);
        }else{
            if(elemSeleccionados[0]==modeloLista.getSize()){ // si el elemento que se borró es el último de la lista
                seleccion.setSelectedIndex(modeloLista.getSize()-1); // se selecciona el elemento anterior al eliminado
            }else{
                seleccion.setSelectedIndex(elemSeleccionados[0]); // seleccionar el elemento siguiente a eliminado
            }
        }
    }
    
    /**
     * Método que muestra la interfaz con los elementos para crear un archivo
     * Excel a partir de una base de datos.
     * @param evt Evento lanzado al presionar el botón que muestra la interfaz
     * para exportar bases de datos.
     */
    private void modoExportActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_modoExportActionPerformed
        modo = EXP;
        //cardLayout2.show(jPanel7, "cardExport");
        jPanel7.removeAll();
        jPanel7.add(panelExp);
        jPanel7.revalidate();
        jPanel7.repaint();
        jPanel4.setBackground(new Color(153,153,153));
    }//GEN-LAST:event_modoExportActionPerformed

    /**
     * Método que muestra la interfaz con los elementos para crear una base de
     * datos a partir de un archivo de Excel.
     * @param evt Evento lanzado al presionar el botón que muestra la interfaz
     * para importar bases de datos.
     */
    private void modoImportActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_modoImportActionPerformed
        modo = IMP;
        //cardLayout2.show(jPanel7, "cardImport");
        jPanel4.setBackground(new Color(104,104,104));
        jPanel7.removeAll();
        jPanel7.add(panelImp);
        jPanel7.revalidate();
        jPanel7.repaint();
    }//GEN-LAST:event_modoImportActionPerformed

    /**
     * Método que configura la apariencia de los botones que cambian la interfaz
     * cuando el usuario pasa el mouse sobre el botón del modo Importar.
     * @param evt Evento lanzado cuando el puntero del mouse entra al área del 
     * botón que cambia el modo de programa a Importar.
     */
    private void btnImportMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnImportMouseEntered
        modoImport.setIcon(new ImageIcon(getClass().getResource("/imagenes/btn2_1.png")));
        modoExport.setIcon(new ImageIcon(getClass().getResource("/imagenes/btn1_1.png")));
    }//GEN-LAST:event_btnImportMouseEntered

    /**
     * Método que configura la apariencia de los botones que cambian la interfaz
     * cuando el usuario hace que el mouse salga del área del botón del modo Importar.
     * @param evt Evento lanzado cuando el puntero del mouse sale del área del
     * botón que cambia el modo del programa a Importar
     */
    private void btnImportMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnImportMouseExited
        if(modo==EXP){
            modoExport.setIcon(new ImageIcon(getClass().getResource("/imagenes/btn1.png")));
            modoImport.setIcon(new ImageIcon(getClass().getResource("/imagenes/btn2.png")));
        }
    }//GEN-LAST:event_btnImportMouseExited

    /**
     * Método que configura la apariencia de los botones que cambian la interfaz
     * cuando el usuario pasa el mouse sobre el botón del modo Exportar.
     * @param evt Evento lanzado cuando el puntero del mouse entral al área del
     * botón que cambia el modo del programa a Exportar.
     */
    private void btnExportarMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnExportarMouseEntered
        modoExport.setIcon(new ImageIcon(getClass().getResource("/imagenes/btn1.png")));
        modoImport.setIcon(new ImageIcon(getClass().getResource("/imagenes/btn2.png")));
    }//GEN-LAST:event_btnExportarMouseEntered

    /**
     * Método que configurs la apariencia de los botones que cambian la interfaz
     * cuando el usuario hace que el mouse salga del área del botón del modo Importar.
     * @param evt Evento lanzado cuando el puntero del mouse sale del área del 
     * botón que cambia el modo del programa a Importar.
     */
    private void btnExportarMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnExportarMouseExited
        if(modo==IMP){
            modoExport.setIcon(new ImageIcon(getClass().getResource("/imagenes/btn1_1.png")));
            modoImport.setIcon(new ImageIcon(getClass().getResource("/imagenes/btn2_1.png")));
        }
    }//GEN-LAST:event_btnExportarMouseExited

   
    /**
     * Método encargado de intentar realizar la conexión con el servidor de BD
     * con los datos proporcionados por el usuario. 
     * Si la conexión se realiza de forma exitosa, el programa muestra la 
     * pantalla que permite exportar una base de datos en un archivo Excel. 
     * Si la conexión no se puede realizar, se muestra un mensaje de error en la
     * pantalla inicial.
     * param evt Evento generado al presionar el botón 'Conectar'. 
     */
    private void btnConectarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnConectarActionPerformed
        mensaje = "Estableciendo la conexión con el servidor...";
        msj.setText(mensaje);
        btnConectar.setEnabled(false);
        servidor = txtServidor.getText();
        usuario = txtUsuario.getText();
        clave = txtClave.getText();
        new Thread(){
            @Override
            public void run(){
                try{
                    conn = new Conexion(servidor,usuario,clave); // Conectar con el servidor
                    panelImp.definirConexion(conn);
                    panelExp.cargarListaDeBases(conn);
                    jPanel7.removeAll();
                    jPanel7.add(panelExp);
                    jPanel7.revalidate();
                    jPanel7.repaint();
                    cardLayout.show(jPanel1, "pantallaSecundaria"); // cambiar a la pantalla de exportación
                }catch(SQLException sqle){
                    mensaje += "\nFalló el intento de conexión. "
                    + "\nError MySQL " + sqle.getErrorCode()+": "+sqle.getMessage()+".";
                    if(sqle.getErrorCode()==1045){
                        mensaje += "\nDatos de conexión incorrectos, verifique e intente de nuevo.";
                    }
                }catch(ClassNotFoundException cnf){
                    //cnf.printStackTrace();
                    mensaje += "\nFalló el intento de conexión."
                    + "\nNo se pudo encontar la librería mysql-conector-java";
                }finally{
                    msj.setText(mensaje);
                    btnConectar.setEnabled(true);
                }
            }
        }.start();
    }//GEN-LAST:event_btnConectarActionPerformed
  
    /**
     * Metodo que permite terminar la ejecución del programa al presionar el 
     * botón para cerrar la ventana. Verifica si existen procesos de importación
     * o exportación ejecutándose antes de terminarlo.
     * @param evt Evento lanzado al presionar el botón que cierra la ventana del
     * programa.
     */
    private void cerrarVentana(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_cerrarVentana
        Object [] opciones ={"Aceptar","Cancelar"};
        if((panelExp.consultarEstadoProceso()==StateValue.STARTED)||(panelImp.consultarEstadoProceso()==StateValue.STARTED)){    
            int eleccion = JOptionPane.showOptionDialog(
                this,
                "Hay procesos ejecutándose, ¿desea cerrar el programa?  ",
                "Confirmar cierre",
                JOptionPane.YES_NO_OPTION,
                JOptionPane.QUESTION_MESSAGE,null,opciones,"Aceptar"
            );
            if (eleccion == JOptionPane.YES_OPTION){
                System.exit(0);
            }
        }else{
            System.exit(0);
        }
    }//GEN-LAST:event_cerrarVentana
    
    public void reiniciarCamposInicio(){
        txtServidor.setText("");
        txtUsuario.setText("");
        txtClave.setText("");
        mensaje = "Conexión terminada.";
        msj.setText(mensaje);
        btnConectar.setEnabled(true);
    }
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        // LookAndFeel nativo
        try {    
            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
        } catch (Exception ex) {
            System.err.println(ex);
        }

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new InterfazGrafica().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnConectar;
    private javax.swing.JButton btnSalir;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JButton modoExport;
    private javax.swing.JButton modoImport;
    private javax.swing.JTextArea msj;
    private javax.swing.JPanel panelExport;
    private javax.swing.JPanel panelImport;
    private javax.swing.JPasswordField txtClave;
    private javax.swing.JTextField txtServidor;
    private javax.swing.JTextField txtUsuario;
    // End of variables declaration//GEN-END:variables
}
